<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Map</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    #map {
      width: 100%;
      height: 400px;
      margin-top: 20px;
    }
    .marker-circle {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      border: 2px solid white;
      box-shadow: 0 0 2px rgba(0,0,0,0.5);
      cursor: pointer;
    }
  </style>

  <!-- âœ… ì¹´ì¹´ì˜¤ ì§€ë„ API + ì¥ì†Œ ê²€ìƒ‰ ë¼ì´ë¸ŒëŸ¬ë¦¬ í¬í•¨ -->
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=faedc692ee4f1fb94b995cdb777abeb9&libraries=services"></script>

</head>
<body>


<!-- âœ… ì‚¬ìš©ì ì„ íƒ ë“œë¡­ë‹¤ìš´ -->
<select id="userSelect">
  <option value="">-- ì‚¬ìš©ì ì„ íƒ --</option>
  <option value="ê¹€ì‹œì—°">ê¹€ì‹œì—°</option>
  <option value="ì´ì¬ì„±">ì´ì¬ì„±</option>
  <option value="ì´ì¬ì›">ì´ì¬ì›</option>
  <option value="í™©ìœ ì„">í™©ìœ ì„</option>
</select>

<!-- âœ… ì§€ë„ ì˜ì—­ -->
<div id="map"></div>

<script>
  const userSelect = document.getElementById('userSelect');

  const map = new kakao.maps.Map(document.getElementById('map'), {
    center: new kakao.maps.LatLng(37.58377, 126.999943),
    level: 3
  });

  const userColors = {
    ê¹€ì‹œì—°: '#e74c3c',
    ì´ì¬ì„±: '#3498db',
    ì´ì¬ì›: '#f1c40f',
    í™©ìœ ì„: '#2ecc71'
  };

  const overlays = [];

  // âœ… ì €ì¥ëœ ë§ˆì»¤ ë¡œë“œ
  const savedMarkers = JSON.parse(localStorage.getItem('markers')) || [];

  savedMarkers.forEach(markerData => {
    addMarker(markerData.user, markerData.lat, markerData.lng, false);
  });

  // âœ… ì§€ë„ í´ë¦­ ì‹œ ë§ˆì»¤ ìƒì„±
  kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
    const selectedUser = userSelect.value;

    if (!selectedUser) {
      alert("ì‚¬ìš©ìë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”!");
      return;
    }

    const lat = mouseEvent.latLng.getLat();
    const lng = mouseEvent.latLng.getLng();

    // ë§ˆì»¤ ìƒì„± ë° ì €ì¥
    addMarker(selectedUser, lat, lng, true);
  });

  // âœ… ë§ˆì»¤ ìƒì„± í•¨ìˆ˜
  function addMarker(user, lat, lng, shouldSave) {
    const position = new kakao.maps.LatLng(lat, lng);
    const color = userColors[user];

    const markerEl = document.createElement('div');
    markerEl.className = 'marker-circle';
    markerEl.style.backgroundColor = color;
    markerEl.title = user;

    const overlay = new kakao.maps.CustomOverlay({
      content: markerEl,
      position: position,
      yAnchor: 1,
      clickable: true
    });

    overlay.setMap(map);
    overlays.push(overlay);

    // ë§ˆì»¤ ì €ì¥
    if (shouldSave) {
      savedMarkers.push({ user, lat, lng });
      localStorage.setItem('markers', JSON.stringify(savedMarkers));
    }

    // ì‚­ì œ ê¸°ëŠ¥
    markerEl.addEventListener('click', function(e) {
      e.stopPropagation();
      const currentUser = userSelect.value;
      if (currentUser !== user) {
        alert("ì´ ë§ˆì»¤ëŠ” ìƒì„±ìë§Œ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
        return;
      }

      if (confirm(`${user}ë‹˜ì˜ ë§ˆì»¤ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        overlay.setMap(null);
      
        // localStorageì—ì„œë„ ì œê±°
        const updated = savedMarkers.filter(m => !(m.user === user && m.lat === lat && m.lng === lng));
        localStorage.setItem('markers', JSON.stringify(updated));
      
        // ğŸ§  ì „ì—­ ë°°ì—´ë„ ì—…ë°ì´íŠ¸! (ì´ê²Œ ì¤‘ìš”!!)
        savedMarkers.length = 0; // ê¸°ì¡´ ë°°ì—´ ë¹„ìš°ê³ 
        updated.forEach(m => savedMarkers.push(m)); // ì—…ë°ì´íŠ¸ëœ ê°’ ë‹¤ì‹œ ë„£ê¸°
      }
      
    });
  }


 
</script>



</body>
</html>
